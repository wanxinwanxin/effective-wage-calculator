<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Effective Hourly Wage Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-section {
            padding: 30px;
        }

        .section-title {
            font-size: 1.4em;
            color: #4a5568;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            background: #f7fafc;
            border-top: 1px solid #e2e8f0;
            padding: 30px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .ehw-value {
            text-align: center;
            margin-bottom: 30px;
        }

        .ehw-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .ehw-positive {
            color: #48bb78;
        }

        .ehw-negative {
            color: #f56565;
        }

        .ehw-neutral {
            color: #4a5568;
        }

        .activity-type {
            font-size: 1.2em;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .explanation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
        }

        .explanation h3 {
            margin-bottom: 15px;
            color: #4a5568;
        }

        .explanation pre {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.6;
        }

        .research-facts {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4299e1;
        }

        .research-facts h3 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.1em;
        }

        .research-fact {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
        }

        .fact-claim {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .fact-details {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .fact-confidence {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .confidence-high {
            background: #c6f6d5;
            color: #22543d;
        }

        .confidence-medium {
            background: #fef5e7;
            color: #c05621;
        }

        .confidence-low {
            background: #fed7d7;
            color: #c53030;
        }

        .fact-population {
            font-size: 0.85em;
            color: #4a5568;
            font-style: italic;
        }

        .fact-citation {
            font-size: 0.8em;
            color: #718096;
            line-height: 1.3;
        }

        .processing-log {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }

        .processing-log h3 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.1em;
        }

        .log-steps {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .log-step {
            padding: 4px 0;
            color: #4a5568;
            border-left: 2px solid transparent;
            padding-left: 8px;
            margin-bottom: 2px;
        }

        .log-step:hover {
            background-color: rgba(40, 167, 69, 0.1);
            border-left-color: #28a745;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #4a5568;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .examples {
            background: #edf2f7;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .examples h4 {
            margin-bottom: 10px;
            color: #4a5568;
        }

        .examples ul {
            list-style: none;
            padding-left: 0;
        }

        .examples li {
            margin-bottom: 5px;
            padding: 5px 10px;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .examples li:hover {
            background: #667eea;
            color: white;
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .ehw-number {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Effective Hourly Wage Calculator</h1>
            <p>Discover the true economic value of any activity</p>
        </div>

        <form id="ehw-form" class="form-section">
            <div class="section-title">About You</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="age">Age (optional)</label>
                    <input type="number" id="age" min="16" max="100" placeholder="e.g., 28">
                </div>
                <div class="form-group">
                    <label for="hourly-wage">Current Hourly Wage (optional)</label>
                    <input type="number" id="hourly-wage" min="0" step="0.01" placeholder="e.g., 25.00">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="profession">Profession (optional)</label>
                    <input type="text" id="profession" placeholder="e.g., Software Engineer">
                </div>
                <div class="form-group">
                    <label for="location">Where do you live? (optional)</label>
                    <input type="text" id="location" placeholder="e.g., San Francisco, CA">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="fitness-level">Fitness Level</label>
                    <select id="fitness-level">
                        <option value="low">Low - Sedentary lifestyle</option>
                        <option value="moderate" selected>Moderate - Some regular exercise</option>
                        <option value="high">High - Very active/athletic</option>
                    </select>
                </div>
            </div>

            <div class="section-title" style="margin-top: 30px;">Activity Description</div>
            
            <div class="form-group">
                <label for="activity">What did you do? (be specific)</label>
                <textarea id="activity" placeholder="e.g., 'Went for a run in the park' or 'Scrolled Instagram' or 'Studied Python programming'"></textarea>
            </div>

            <button type="submit" class="calculate-btn">Calculate EHW</button>

            <div class="examples">
                <h4>Try these examples:</h4>
                <ul>
                    <li onclick="fillExample('Went for a jog around the neighborhood')">
                        üèÉ‚Äç‚ôÇÔ∏è Went for a jog around the neighborhood
                    </li>
                    <li onclick="fillExample('Scrolled TikTok and Instagram')">
                        üì± Scrolled TikTok and Instagram
                    </li>
                    <li onclick="fillExample('Took an online course in data analysis')">
                        üìö Took an online course in data analysis
                    </li>
                </ul>
            </div>
        </form>

        <div id="results" class="results">
            <div id="loading" class="loading" style="display: none;">
                <p>üßÆ Calculating your effective hourly wage...</p>
            </div>

            <div id="results-content" style="display: none;">
                <div class="ehw-value">
                    <div class="activity-type" id="activity-type"></div>
                    <div class="ehw-number" id="ehw-number"></div>
                    <div>per hour</div>
                </div>

                <div class="explanation">
                    <h3>üí° How We Calculated This</h3>
                    <pre id="explanation-text"></pre>
                </div>
            </div>

            <div id="error-message" class="error" style="display: none;"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // Load configuration
        const API_BASE = window.EHW_CONFIG.getApiBase();

        function fillExample(activity) {
            document.getElementById('activity').value = activity;
        }

        async function calculateEHW(formData) {
            const response = await fetch(`${API_BASE}/calculate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Calculation failed');
            }

            return await response.json();
        }

        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const contentDiv = document.getElementById('results-content');
            const errorDiv = document.getElementById('error-message');

            // Hide loading and error
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            // Show results
            resultsDiv.classList.add('show');
            contentDiv.style.display = 'block';

            // Set activity type and confidence
            const activityTypeEl = document.getElementById('activity-type');
            activityTypeEl.textContent = `${result.activity_type} (${result.confidence_level} confidence)`;

            // Set EHW value with appropriate styling
            const ehwNumber = document.getElementById('ehw-number');
            const value = result.effective_hourly_wage;
            
            ehwNumber.textContent = `$${Math.abs(value).toFixed(2)}`;
            
            if (value > 0) {
                ehwNumber.className = 'ehw-number ehw-positive';
                ehwNumber.textContent = `+$${value.toFixed(2)}`;
            } else if (value < 0) {
                ehwNumber.className = 'ehw-number ehw-negative';
                ehwNumber.textContent = `-$${Math.abs(value).toFixed(2)}`;
            } else {
                ehwNumber.className = 'ehw-number ehw-neutral';
                ehwNumber.textContent = `$${value.toFixed(2)}`;
            }

            // Show processing log (step-by-step breakdown)
            displayProcessingLog(result.processing_log);

            // Set detailed explanation (now with markdown-like formatting)
            const explanationEl = document.getElementById('explanation-text');
            explanationEl.innerHTML = formatExplanation(result.explanation);
            
            // Show research facts if available
            displayResearchFacts(result.research_facts_used);
        }

        function displayProcessingLog(processingLog) {
            // Remove existing processing log section
            const existingLogSection = document.querySelector('.processing-log');
            if (existingLogSection) {
                existingLogSection.remove();
            }

            if (!processingLog || processingLog.length === 0) return;

            // Create processing log section
            const logSection = document.createElement('div');
            logSection.className = 'processing-log';
            logSection.innerHTML = `
                <h3>üîç How We Calculated This</h3>
                <div class="log-steps">
                    ${processingLog.map(step => `
                        <div class="log-step">${step}</div>
                    `).join('')}
                </div>
            `;

            // Add to results (before explanation)
            const explanationSection = document.querySelector('.explanation');
            explanationSection.parentNode.insertBefore(logSection, explanationSection);
        }

        function formatExplanation(text) {
            // Convert markdown-like formatting to HTML
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\*(.*?)\*/g, '<em>$1</em>') // Italic
                .replace(/^‚Ä¢ (.*$)/gim, '&bull; $1') // Bullet points
                .replace(/\n/g, '<br>') // Line breaks
                .replace(/\$(\d+(?:,\d{3})*(?:\.\d{2})?)/g, '<span style="color: #2d5aa0; font-weight: bold;">$$$1</span>'); // Highlight money
        }

        function displayResearchFacts(facts) {
            // Remove existing research facts section
            const existingFactsSection = document.querySelector('.research-facts');
            if (existingFactsSection) {
                existingFactsSection.remove();
            }

            if (!facts || facts.length === 0) return;

            // Create research facts section
            const factsSection = document.createElement('div');
            factsSection.className = 'research-facts';
            factsSection.innerHTML = `
                <h3>üìö Research Evidence</h3>
                <div class="facts-list">
                    ${facts.map(fact => `
                        <div class="research-fact">
                            <div class="fact-claim">${fact.claim}</div>
                            <div class="fact-details">
                                <span class="fact-confidence confidence-${fact.confidence}">${fact.confidence.toUpperCase()} CONFIDENCE</span>
                                <span class="fact-population">${fact.population}</span>
                            </div>
                            <div class="fact-citation">${fact.citation}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Add to results
            document.getElementById('results-content').appendChild(factsSection);
        }

        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const contentDiv = document.getElementById('results-content');
            const errorDiv = document.getElementById('error-message');

            loadingDiv.style.display = 'none';
            contentDiv.style.display = 'none';
            
            resultsDiv.classList.add('show');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
        }

        document.getElementById('ehw-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Show loading
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const contentDiv = document.getElementById('results-content');
            const errorDiv = document.getElementById('error-message');

            resultsDiv.classList.add('show');
            loadingDiv.style.display = 'block';
            contentDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            // Gather form data
            const age = document.getElementById('age').value;
            const hourlyWage = document.getElementById('hourly-wage').value;
            const profession = document.getElementById('profession').value;
            const location = document.getElementById('location').value;
            const fitnessLevel = document.getElementById('fitness-level').value;
            const activity = document.getElementById('activity').value;

            if (!activity.trim()) {
                displayError('Please describe your activity');
                return;
            }

            const requestData = {
                user_profile: {
                    age: age ? parseInt(age) : null,
                    current_hourly_wage: hourlyWage ? parseFloat(hourlyWage) : null,
                    profession: profession || null,
                    location: location || null,
                    fitness_level: fitnessLevel
                },
                activity_description: activity,
                duration_hours: 1.0  // Always calculate per hour
            };

            try {
                const result = await calculateEHW(requestData);
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                displayError(error.message || 'Something went wrong. Please try again.');
            }
        });

        // Check if API is running on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE}/`);
                if (!response.ok) {
                    throw new Error('API not responding');
                }
                console.log('‚úÖ Connected to EHW Calculator API');
            } catch (error) {
                console.warn('‚ö†Ô∏è Cannot connect to API. Make sure the backend is running on http://localhost:8000');
            }
        });
    </script>
</body>
</html> 